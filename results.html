<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Daily Tool Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        select, button { padding: 10px; margin: 5px; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #4361ee; color: white; }
        .qty { font-weight: bold; color: green; }
        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Daily Tool Tracking</h1>
        
        <select id="dateSelect">
            <option value="">Select Date</option>
        </select>
        <button onclick="loadData()">Load Data</button>
        
        <div id="loading" class="loading" style="display:none;">Loading...</div>
        <div id="results"></div>
    </div>

    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec";
        
        // Load dates on page load
        window.onload = function() {
            fetch(WEB_APP_URL + '?action=getDates')
                .then(r => r.json())
                .then(data => {
                    const select = document.getElementById('dateSelect');
                    data.forEach(date => {
                        const option = document.createElement('option');
                        option.value = date;
                        option.textContent = date;
                        select.appendChild(option);
                    });
                    // Auto-select today
                    const today = getTodayFormat();
                    if (data.includes(today)) {
                        select.value = today;
                        loadData();
                    }
                })
                .catch(e => console.error(e));
        };
        
        function getTodayFormat() {
            const today = new Date();
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            return '{ ' + days[today.getDay()] + '-' + today.getDate() + ' | ' + months[today.getMonth()] + '-' + (today.getMonth() + 1) + ' | ' + today.getFullYear() + ' }';
        }
        
        function loadData() {
            const date = document.getElementById('dateSelect').value;
            if (!date) return;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
            
            fetch(WEB_APP_URL + '?action=getData&date=' + encodeURIComponent(date))
                .then(r => r.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none';
                    
                    if (data.error) {
                        document.getElementById('results').innerHTML = '<p style="color:red;">Error: ' + data.error + '</p>';
                        return;
                    }
                    
                    if (data.length === 0) {
                        document.getElementById('results').innerHTML = '<p>No tools checked out on this date.</p>';
                        return;
                    }
                    
                    let html = '<table><thead><tr><th>Person</th><th>Tool Code</th><th>Description</th><th>Quantity</th><th>Date</th></tr></thead><tbody>';
                    data.forEach(item => {
                        html += `<tr>
                            <td>${item.personCode}</td>
                            <td>${item.toolCode}</td>
                            <td>${item.toolDescription}</td>
                            <td class="qty">${item.quantity}</td>
                            <td>${item.checkoutDate}</td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    document.getElementById('results').innerHTML = html;
                })
                .catch(e => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('results').innerHTML = '<p style="color:red;">Failed to load  ' + e.message + '</p>';
                });
        }
    </script>
</body>
</html>
